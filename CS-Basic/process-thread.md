# 进程和线程
- [进程和线程](#%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B)
  - [异同](#%E5%BC%82%E5%90%8C)
  - [互斥锁](#%E4%BA%92%E6%96%A5%E9%94%81)
  - [浏览器](#%E6%B5%8F%E8%A7%88%E5%99%A8)
    - [GUI 渲染线程](#gui-%E6%B8%B2%E6%9F%93%E7%BA%BF%E7%A8%8B)
    - [JavaScript 引擎线程](#javascript-%E5%BC%95%E6%93%8E%E7%BA%BF%E7%A8%8B)
    - [定时触发器线程](#%E5%AE%9A%E6%97%B6%E8%A7%A6%E5%8F%91%E5%99%A8%E7%BA%BF%E7%A8%8B)
    - [异步 http 请求线程](#%E5%BC%82%E6%AD%A5-http-%E8%AF%B7%E6%B1%82%E7%BA%BF%E7%A8%8B)
    - [事件触发线程](#%E4%BA%8B%E4%BB%B6%E8%A7%A6%E5%8F%91%E7%BA%BF%E7%A8%8B)

## 异同
进程是**资源分配**的最小单位，线程是**程序执行**的最小单位。

- 定义方面：进程是程序在某个数据集合上的一次运行活动；线程是进程中的一个执行单元。
- 角色方面：在支持线程机制的系统中，进程是系统资源分配的单位，线程是系统调度的单位。
- 资源共享方面：进程之间不能共享资源，而线程共享所在进程的地址空间和其它资源。同时线程还有自己的栈和栈指针，程序计数器等寄存器。
- 独立性方面：进程有自己独立的地址空间，而线程没有，线程必须依赖于进程而存在。

## 互斥锁
互斥锁（Mutual exclusion，缩写Mutex）是一种用于多线程编程中，防止**两条线程同时对同一公共资源（比如全局变量）进行读写**的机制。

## 浏览器
  浏览器中，每个 tab 都是一个进程，每个进程包括以下线程：

  ### GUI 渲染线程
  - 负责渲染浏览器界面，解析HTML，CSS，构建 DOM树 和RenderObject树，布局和绘制等。
  - 当界面需要重绘（Repaint）或由于某种操作引发回流(reflow)时，该线程就会执行。
  - 注意，GUI 渲染线程与 JS 引擎线程是互斥的，当 JS 引擎执行时 GUI 线程会被挂起（相当于被冻结了），GUI更新会被保存在一个队列中等到JS引擎空闲时立即被执行。

  ### JavaScript 引擎线程
  也可以称为 JS 内核，例如 V8 引擎。Javascript 引擎线程负责解析 Javascript 脚本，运行代码。

  ### 定时触发器线程
  - `setInterval` 与 `setTimeout` 所在线程
  - 浏览器定时计数器并不是由 JavaScript 引擎计数的,（因为JavaScript引擎是单线程的, 如果处于阻塞线程状态就会影响记计时的准确）
  - 因此通过单独线程来计时并触发定时（**计时完毕后，添加到事件队列中，等待JS引擎空闲后执行**）
  - 注意，W3C 在 HTM L标准中规定，规定要求 `setTimeout` 中低于 `4ms` 的时间间隔算为 `4ms`。

  ### 异步 http 请求线程
  `XMLHttpRequest` 连接后，浏览器新开一个线程，当检测到**状态变更**时，如果设置有回调函数，**异步线程就产生状态变更事件，将这个回调再放入事件队列中**。再由JavaScript 引擎执行。
  
  ### 事件触发线程
  - 归属于浏览器而不是 JS 引擎，用来控制事件循环（可以理解，JS 引擎自己都忙不过来，需要浏览器另开线程协助）
  - 当JS引擎执行代码块如 setTimeOut 时（也可来自浏览器内核的其他线程,如鼠标点击、AJAX 异步请求等），会将对应任务添加到事件线程中。
  - 当对应的事件符合触发条件被触发时，该线程会把事件添加到待处理队列的队尾，等待JS引擎的处理
  - 注意，由于 JS 的单线程关系，所以这些待处理队列中的事件都得排队等待 JS 引擎处理（**当JS引擎空闲时才会去执行**）